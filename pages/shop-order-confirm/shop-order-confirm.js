(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shop-order-confirm/shop-order-confirm"],{"50f0":function(e,t,r){"use strict";r.r(t);var n=r("701e"),s=r("e508");for(var o in s)"default"!==o&&function(e){r.d(t,e,(function(){return s[e]}))}(o);r("8987");var a,u=r("f0c5"),i=Object(u["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);t["default"]=i.exports},"701e":function(e,t,r){"use strict";var n,s=function(){var e=this,t=e.$createElement;e._self._c},o=[];r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return n}))},"7c4f":function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r("a34a"));function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r,n,s,o,a){try{var u=e[o](a),i=u.value}catch(d){return void r(d)}u.done?t(i):Promise.resolve(i).then(n,s)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function u(e){o(a,n,s,u,i,"next",e)}function i(e){o(a,n,s,u,i,"throw",e)}u(void 0)}))}}var u={data:function(){return{user:{},orderGoods:{},address:{},total:0,type:1,seat:0}},onLoad:function(){var e=a(n.default.mark((function e(t){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.type=t.type,this.seat=t.seat;case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),onShow:function(){var t=a(n.default.mark((function t(){var r,s,o,a;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.getStorageSync("nowTable"),t.next=3,this.$api.session(r);case 3:if(s=t.sent,this.user=s.data,1==this.seat){t.next=15;break}if(o=e.getStorageSync("address"),!o||this.user.id!=this.address.userid){t.next=11;break}this.address=e.getStorageSync("address"),t.next=15;break;case 11:return t.next=13,this.$api.defaultAddress(this.user.id);case 13:s=t.sent,this.address=s.data;case 15:if(this.orderGoods=e.getStorageSync("orderGoods"),1!=this.seat)for(a=0;a<this.orderGoods.length;a++)this.total=parseFloat(this.orderGoods[a].price)*this.orderGoods[a].buynumber;else this.total=parseFloat(this.orderGoods[0].total),this.address=this.orderGoods[0].address;case 17:case"end":return t.stop()}}),t,this)})));function r(){return t.apply(this,arguments)}return r}(),methods:{onSubmitTap:function(){var t=a(n.default.mark((function t(){var r,s;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=this,s=e.getStorageSync("nowTable"),e.showModal({title:"提示",content:"是否确认支付",success:function(){var t=a(n.default.mark((function t(o){var a,u,i,d;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!o.confirm){t.next=42;break}if(a=r.type,u=!0,1!=a){t.next=10;break}if(!(r.user.money<r.total)){t.next=8;break}return r.$utils.msg("余额不足，请先充值"),u=!1,t.abrupt("return");case 8:t.next=15;break;case 10:if(2!=a){t.next=15;break}if(!(r.user.jifen<r.total)){t.next=15;break}return r.$utils.msg("积分不足，兑换商品失败"),u=!1,t.abrupt("return");case 15:i=0;case 16:if(!(i<r.orderGoods.length)){t.next=28;break}return d={orderid:r.$utils.genTradeNo(),tablename:r.orderGoods[i].tablename,userid:r.user.id,goodid:r.orderGoods[i].goodid,goodname:r.orderGoods[i].goodname,picture:r.orderGoods[i].picture,buynumber:r.orderGoods[i].buynumber,discountprice:r.orderGoods[i].price,price:r.orderGoods[i].price,total:r.orderGoods[i].price*r.orderGoods[i].buynumber,discounttotal:r.orderGoods[i].price*r.orderGoods[i].buynumber,type:a,address:r.address.address,status:"已支付"},1==r.seat&&(d["address"]=r.address),t.next=21,r.$api.add("orders",d);case 21:if(!r.orderGoods[i].id){t.next=25;break}return t.next=24,r.$api.del("cart",JSON.stringify([r.orderGoods[i].id]));case 24:e.removeStorageSync("cart".concat(r.orderGoods[i].goodid).concat(r.user.id));case 25:i++,t.next=16;break;case 28:if(!u){t.next=42;break}if(1!=a){t.next=37;break}return r.$utils.msgBack("支付成功"),r.user.money=r.user.money-r.total,(r.user.jifen||0==r.user.jifen)&&(r.user.jifen=r.user.jifen+r.total),t.next=35,r.$api.update(s,r.user);case 35:t.next=42;break;case 37:if(2!=a){t.next=42;break}return r.$utils.msgBack("兑换成功"),r.user.jifen=r.user.jifen-r.total,t.next=42,r.$api.update(s,r.user);case 42:case"end":return t.stop()}}),t)})));function o(e){return t.apply(this,arguments)}return o}()});case 3:case"end":return t.stop()}}),t,this)})));function r(){return t.apply(this,arguments)}return r}(),onAddressTap:function(){this.$utils.jump("../shop-address/shop-address")}}};t.default=u}).call(this,r("543d")["default"])},8987:function(e,t,r){"use strict";var n=r("c533"),s=r.n(n);s.a},bb30:function(e,t,r){"use strict";(function(e){r("54d1"),r("921b");n(r("66fd"));var t=n(r("50f0"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},c533:function(e,t,r){},e508:function(e,t,r){"use strict";r.r(t);var n=r("7c4f"),s=r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=s.a}},[["bb30","common/runtime","common/vendor"]]]);